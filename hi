SELECT 
    CASE WHEN TBL1.ROWNUM_MINUS_1 IS NOT NULL THEN TBL1.ROWNUM_MINUS_1
         WHEN TBL2.ROWNUM_MINUS_1 IS NOT NULL THEN TBL2.ROWNUM_MINUS_1
         WHEN nest_tbl1.ROWNUM_MINUS_1 IS NOT NULL THEN nest_tbl1.ROWNUM_MINUS_1
         WHEN tab1.ROWNUM_MINUS_1 IS NOT NULL THEN tab1.ROWNUM_MINUS_1
         WHEN TBL3.ROWNUM_MINUS_1 IS NOT NULL THEN TBL3.ROWNUM_MINUS_1
         WHEN nest_tbl2.ROWNUM_MINUS_1 IS NOT NULL THEN nest_tbl2.ROWNUM_MINUS_1
         WHEN TBL4.ROWNUM_MINUS_1 IS NOT NULL THEN TBL4.ROWNUM_MINUS_1
         WHEN intq.ROWNUM_MINUS_1 IS NOT NULL THEN intq.ROWNUM_MINUS_1
    END AS ROWNUM_MINUS_1,
    TBL1.ID AS BCBSA_VBP_ID,
    TBL2.PRCTR_ROLE_ID AS PROV_MBR_SLF_ATRBTN_IND,
    nest_tbl1.PRCTR_ROLE_ID,
    tab1.PRCTR_ROLE_ID,
    TBL3.PRCTR_ROLE_ID,
    nest_tbl2.PRCTR_ROLE_ID,
    TBL4.LCTN_RESOURCE_ID,
    intq.ID AS PROV_HLTH_SRVC_RESOURCE_ID
FROM (
    SELECT ROWNUM-1 AS ROWNUM_MINUS_1, BCBSA_VBP_ID AS ID, VBP.PROV_RESOURCE_ID
    FROM PDT.WRK_PRCTR_ROLE_LCTN_XWALK PR
    INNER JOIN PDT.WRK_PRCTR_ROLE RL ON RL.PRCTR_ROLE_ID = PR.PRCTR_ROLE_ID
    INNER JOIN PDT.PROV_VBP VBP ON RL.PROV_RESOURCE_ID = VBP.PROV_RESOURCE_ID
        AND PR.LCTN_RESOURCE_ID = VBP.LCTN_RESOURCE_ID
        AND RL.NTWK_RESOURCE_ID = VBP.NTWK_RESOURCE_ID
    INNER JOIN PDT.BCBSA_PLANCD_VBP_XWALK PLV ON VBP.BCBSA_VBP_ID = PLV.VBP_ID
        AND SUBSTR(RL.NTWK_RESOURCE_ID, 0, 3) = PLV.PLAN_CD
) TBL1

LEFT JOIN (
    SELECT DISTINCT VBP.PROV_RESOURCE_ID, VBP.PROV_MBR_SLF_ATRBTN_IND
    FROM PDT.WRK_PRCTR_ROLE_LCTN_XWALK PR
    INNER JOIN PDT.WRK_PRCTR_ROLE RL ON RL.PRCTR_ROLE_ID = PR.PRCTR_ROLE_ID
    INNER JOIN PDT.PROV_VBP VBP ON RL.PROV_RESOURCE_ID = VBP.PROV_RESOURCE_ID
        AND PR.LCTN_RESOURCE_ID = VBP.LCTN_RESOURCE_ID
        AND RL.NTWK_RESOURCE_ID = VBP.NTWK_RESOURCE_ID
    INNER JOIN PDT.BCBSA_PLANCD_VBP_XWALK PLV ON VBP.BCBSA_VBP_ID = PLV.VBP_ID
        AND SUBSTR(RL.NTWK_RESOURCE_ID, 0, 3) = PLV.PLAN_CD
) TBL2 ON TBL1.PROV_RESOURCE_ID = TBL2.PROV_RESOURCE_ID

LEFT JOIN (
    SELECT DISTINCT PRCTR_ROLE_ID, AFFLTN_TYPE
    FROM PDT.WRK_PRCTR_ROLE
) nest_tbl1 ON nest_tbl1.PRCTR_ROLE_ID = TBL2.PRCTR_ROLE_ID

LEFT JOIN (
    SELECT DISTINCT PRCTR_ROLE_ID, PROV_AFFLTN_RESOURCE_ID, PROV_HOSP_AFFLTN_TYPE,
           CASE WHEN PROV_HOSP_AFFLTN_TYPE = 'ADMITPRIV' THEN 'Hospital admitting privileges' ELSE 'Facility affiliation' END AS DISPLAY
    FROM PDT.WRK_PRCTR_ROLE
    WHERE PROV_AFFLTN_RESOURCE_ID IS NOT NULL
) tab1 ON tab1.PRCTR_ROLE_ID = nest_tbl1.PRCTR_ROLE_ID

LEFT JOIN (
    SELECT DISTINCT PRCTR_ROLE_ID, VBP.PROV_ENTY_ID
    FROM PDT.WRK_PRCTR_ROLE_LCTN_XWALK PR
    INNER JOIN PDT.WRK_PRCTR_ROLE RL ON RL.PRCTR_ROLE_ID = PR.PRCTR_ROLE_ID
    INNER JOIN PDT.PROV_VBP VBP ON RL.PROV_RESOURCE_ID = VBP.PROV_RESOURCE_ID
        AND PR.LCTN_RESOURCE_ID = VBP.LCTN_RESOURCE_ID
        AND RL.NTWK_RESOURCE_ID = VBP.NTWK_RESOURCE_ID
    INNER JOIN PDT.BCBSA_PLANCD_VBP_XWALK PLV ON VBP.BCBSA_VBP_ID = PLV.VBP_ID
        AND SUBSTR(RL.NTWK_RESOURCE_ID, 0, 3) = PLV.PLAN_CD
    WHERE VBP.PROV_ENTY_ID IS NOT NULL
) TBL3 ON TBL3.PRCTR_ROLE_ID = tab1.PRCTR_ROLE_ID

LEFT JOIN (
    SELECT DISTINCT PRCTR_ROLE_ID, TXNMY_CD, TXNMY_DSPLY_VAL
    FROM PDT.WRK_PRCTR_ROLE 
) nest_tbl2 ON nest_tbl2.PRCTR_ROLE_ID = TBL3.PRCTR_ROLE_ID

LEFT JOIN (
    SELECT DISTINCT LCTN_RESOURCE_ID
    FROM PDT.wrk_prctr_role_lctn_xwalk
) TBL4 ON TBL4.LCTN_RESOURCE_ID = TBL3.LCTN_RESOURCE_ID

LEFT JOIN (
    SELECT DISTINCT PH.PROV_HLTH_SRVC_RESOURCE_ID AS ID
    FROM PDT.WRK_PROV_HLTH_SRVC PH
    INNER JOIN PDT.wrk_prctr_role_lctn_xwalk PR ON PH.LCTN_RESOURCE_ID = PR.LCTN_RESOURCE_ID
                                                AND PH.PRCTR_ROLE_RESOURCE_ID = PR.PRCTR_ROLE_ID 
) intq ON intq.ID = TBL4.PROV_HLTH_SRVC_RESOURCE_ID;



//coalsec

SELECT 
    COALESCE(TBL1.ROWNUM_MINUS_1, TBL2.ROWNUM_MINUS_1, nest_tbl1.ROWNUM_MINUS_1, tab1.ROWNUM_MINUS_1, TBL3.ROWNUM_MINUS_1, nest_tbl2.ROWNUM_MINUS_1, TBL4.ROWNUM_MINUS_1, intq.ROWNUM_MINUS_1) AS ROWNUM_MINUS_1,
    TBL1.ID AS BCBSA_VBP_ID,
    TBL2.PROV_MBR_SLF_ATRBTN_IND,
    nest_tbl1.PRCTR_ROLE_ID,
    tab1.PRCTR_ROLE_ID,
    TBL3.PROV_ENTY_ID,
    nest_tbl2.TXNMY_CD,
    nest_tbl2.TXNMY_DSPLY_VAL,
    TBL4.LCTN_RESOURCE_ID,
    intq.PROV_HLTH_SRVC_RESOURCE_ID
FROM (
    SELECT ROWNUM-1 AS ROWNUM_MINUS_1, BCBSA_VBP_ID AS ID, VBP.PROV_RESOURCE_ID
    FROM PDT.WRK_PRCTR_ROLE_LCTN_XWALK PR
    INNER JOIN PDT.WRK_PRCTR_ROLE RL ON RL.PRCTR_ROLE_ID = PR.PRCTR_ROLE_ID
    INNER JOIN PDT.PROV_VBP VBP ON RL.PROV_RESOURCE_ID = VBP.PROV_RESOURCE_ID
        AND PR.LCTN_RESOURCE_ID = VBP.LCTN_RESOURCE_ID
        AND RL.NTWK_RESOURCE_ID = VBP.NTWK_RESOURCE_ID
    INNER JOIN PDT.BCBSA_PLANCD_VBP_XWALK PLV ON VBP.BCBSA_VBP_ID = PLV.VBP_ID
        AND SUBSTR(RL.NTWK_RESOURCE_ID, 0, 3) = PLV.PLAN_CD
) TBL1

LEFT JOIN (
    SELECT DISTINCT VBP.PROV_RESOURCE_ID, VBP.PROV_MBR_SLF_ATRBTN_IND
    FROM PDT.WRK_PRCTR_ROLE_LCTN_XWALK PR
    INNER JOIN PDT.WRK_PRCTR_ROLE RL ON RL.PRCTR_ROLE_ID = PR.PRCTR_ROLE_ID
    INNER JOIN PDT.PROV_VBP VBP ON RL.PROV_RESOURCE_ID = VBP.PROV_RESOURCE_ID
        AND PR.LCTN_RESOURCE_ID = VBP.LCTN_RESOURCE_ID
        AND RL.NTWK_RESOURCE_ID = VBP.NTWK_RESOURCE_ID
    INNER JOIN PDT.BCBSA_PLANCD_VBP_XWALK PLV ON VBP.BCBSA_VBP_ID = PLV.VBP_ID
        AND SUBSTR(RL.NTWK_RESOURCE_ID, 0, 3) = PLV.PLAN_CD
) TBL2 ON TBL1.PROV_RESOURCE_ID = TBL2.PROV_RESOURCE_ID

LEFT JOIN (
    SELECT DISTINCT PRCTR_ROLE_ID, AFFLTN_TYPE
    FROM PDT.WRK_PRCTR_ROLE
) nest_tbl1 ON nest_tbl1.PRCTR_ROLE_ID = TBL2.PRCTR_ROLE_ID

LEFT JOIN (
    SELECT DISTINCT PRCTR_ROLE_ID, PROV_AFFLTN_RESOURCE_ID, PROV_HOSP_AFFLTN_TYPE,
           CASE WHEN PROV_HOSP_AFFLTN_TYPE = 'ADMITPRIV' THEN 'Hospital admitting privileges' ELSE 'Facility affiliation' END AS DISPLAY
    FROM PDT.WRK_PRCTR_ROLE
    WHERE PROV_AFFLTN_RESOURCE_ID IS NOT NULL
) tab1 ON tab1.PRCTR_ROLE_ID = nest_tbl1.PRCTR_ROLE_ID

LEFT JOIN (
    SELECT DISTINCT PRCTR_ROLE_ID, VBP.PROV_ENTY_ID
    FROM PDT.WRK_PRCTR_ROLE_LCTN_XWALK PR
    INNER JOIN PDT.WRK_PRCTR_ROLE RL ON RL.PRCTR_ROLE_ID = PR.PRCTR_ROLE_ID
    INNER JOIN PDT.PROV_VBP VBP ON RL.PROV_RESOURCE_ID = VBP.PROV_RESOURCE_ID
        AND PR.LCTN_RESOURCE_ID = VBP.LCTN_RESOURCE_ID
        AND RL.NTWK_RESOURCE_ID = VBP.NTWK_RESOURCE_ID
    INNER JOIN PDT.BCBSA_PLANCD_VBP_XWALK PLV ON VBP.BCBSA_VBP_ID = PLV.VBP_ID
        AND SUBSTR(RL.NTWK_RESOURCE_ID, 0, 3) = PLV.PLAN_CD
    WHERE VBP.PROV_ENTY_ID IS NOT NULL
) TBL3 ON TBL3.PRCTR_ROLE_ID = tab1.PRCTR_ROLE_ID

LEFT JOIN (
    SELECT DISTINCT PRCTR_ROLE_ID, TXNMY_CD, TXNMY_DSPLY_VAL
    FROM PDT.WRK_PRCTR_ROLE 
) nest_tbl2 ON nest_tbl2.PRCTR_ROLE_ID = TBL3.PRCTR_ROLE_ID

LEFT JOIN (
    SELECT DISTINCT LCTN_RESOURCE_ID
    FROM PDT.wrk_prctr_role_lctn_xwalk
) TBL4 ON TBL4.LCTN_RESOURCE_ID = TBL3.LCTN_RESOURCE_ID

LEFT JOIN (
    SELECT DISTINCT PH.PROV_HLTH_SRVC_RESOURCE_ID AS PROV_HLTH_SRVC_RESOURCE_ID
    FROM PDT.WRK_PROV_HLTH_SRVC PH
    INNER JOIN PDT.wrk_prctr_role_lctn_xwalk PR ON PH.LCTN_RESOURCE_ID = PR.LCTN_RESOURCE_ID
                                                AND PH.PRCTR_ROLE_RESOURCE_ID = PR.PRCTR_ROLE_ID 
) intq ON intq.PROV_HLTH_SRVC_RESOURCE_ID = TBL4.LCTN_RESOURCE_ID;
